<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VetManager Pro | Video Edition</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0" />

  <style>
    :root {
      --primary: #48c78e;
      --accent: #3273dc;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
      min-height: 100vh;
    }

    /* --- ESTILOS DE LA CARTA CON VIDEO --- */
    .mascota-card {
      border-radius: 15px;
      border: none;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden; /* Importante para que el video no se salga */
      background: white;
      z-index: 1;
    }

    /* El video de fondo */
    .video-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1; /* Se va al fondo */
      opacity: 0.4; /* Bajamos la opacidad para que el texto se lea bien */
    }

    /* Capa extra para asegurar legibilidad si el video es muy brillante */
    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.4);
      z-index: -1;
    }

    .mascota-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }

    /* Ajuste de contenido para que flote sobre el video */
    .card-content, .card-footer {
      background: transparent;
      position: relative;
    }

    /* Estilos previos mantenidos */
    .main-title-container { display: flex; align-items: center; justify-content: center; gap: 15px; margin: 2rem 0; }
    .title-gif { font-size: 3.5rem; animation: heartBeat 1.5s infinite; color: var(--primary); }
    @keyframes heartBeat { 0%, 28%, 70% { transform: scale(1); } 14%, 42% { transform: scale(1.1); } }
    .mascota-icono-gif { position: absolute; top: 15px; right: 15px; font-size: 2.8rem; color: var(--primary); animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
    .modal-card-head.is-edit { background-color: var(--accent); }
    .modal-card-head.is-new { background-color: var(--primary); }
  </style>
</head>

<body>

  <section class="section">
    <div class="container">
      <div class="main-title-container">
        <span class="material-symbols-rounded title-gif">pets</span>
        <h1 class="title is-2">VetManager <span class="has-text-weight-light">Pro</span></h1>
      </div>

      <div class="box is-radiusless" style="border-radius: 12px !important;">
        <div class="columns is-vcentered">
          <div class="column is-4">
            <div class="field">
              <label class="label is-small">Filtrar por tablero</label>
              <div class="select is-fullwidth is-rounded">
                <select id="filtroEstado">
                  <option value="todas">Todos los pacientes</option>
                  <option value="Abierta">Abiertas</option>
                  <option value="Terminada">Terminadas</option>
                  <option value="Anulada">Anuladas</option>
                </select>
              </div>
            </div>
          </div>
          <div class="column has-text-right">
            <button id="btnAbrirModal" class="button is-primary is-rounded is-medium">
              <span class="material-symbols-rounded mr-2">add</span> Agendar Paciente
            </button>
          </div>
        </div>
      </div>

      <div id="listaCitas" class="columns is-multiline"></div>
    </div>
  </section>

  <div class="modal" id="modalCita">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head" id="modalHeader">
        <p class="modal-card-title has-text-white" id="modalTitulo">Nueva Cita</p>
        <button class="delete" id="cerrarModal"></button>
      </header>
      <section class="modal-card-body">
        <div class="columns is-multiline">
          <div class="column is-6"><label class="label">Mascota</label><input id="mascota" class="input"></div>
          <div class="column is-6">
            <label class="label">Especie</label>
            <div class="select is-fullwidth">
              <select id="tipoMascota">
                <option value="perro">Perro</option>
                <option value="gato">Gato</option>
                <option value="ave">Ave</option>
                <option value="reptil">Reptil</option>
                <option value="conejo">Conejo</option>
                <option value="hamster">Hámster</option>
                <option value="caballo">Caballo</option>
                <option value="huron">Hurón</option>
              </select>
            </div>
          </div>
          <div class="column is-6">
            <label class="label">Estado</label>
            <div class="select is-fullwidth is-info"><select id="estado"><option value="Abierta">Abierta</option><option value="Terminada">Terminada</option><option value="Anulada">Anulada</option></select></div>
          </div>
          <div class="column is-6"><label class="label">Propietario</label><input id="propietario" class="input"></div>
          <div class="column is-6"><label class="label">Fecha</label><input id="fecha" type="date" class="input"></div>
          <div class="column is-6"><label class="label">Hora</label><input id="hora" type="time" class="input"></div>
          <div class="column is-12"><label class="label">Síntomas</label><textarea id="sintomas" class="textarea" rows="2"></textarea></div>
          <input type="hidden" id="telefono" value="N/A">
        </div>
      </section>
      <footer class="modal-card-foot"><button id="guardarCita" class="button is-success is-fullwidth">Confirmar Datos</button></footer>
    </div>
  </div>

  <script>
    let citas = [];
    let editingID = null;

    const modal = document.getElementById("modalCita");
    const campos = ['mascota', 'tipoMascota', 'propietario', 'fecha', 'hora', 'sintomas', 'estado'];

    document.getElementById("btnAbrirModal").onclick = () => {
      editingID = null;
      document.getElementById("modalHeader").className = "modal-card-head is-new";
      campos.forEach(id => document.getElementById(id).value = (id === 'tipoMascota' ? 'perro' : id === 'estado' ? 'Abierta' : ''));
      modal.classList.add("is-active");
    };

    document.getElementById("guardarCita").onclick = () => {
      const data = {};
      campos.forEach(id => data[id] = document.getElementById(id).value);
      if (Object.values(data).some(v => !v)) return alert("Complete los campos");

      if (editingID) {
        const index = citas.findIndex(c => c.id === editingID);
        citas[index] = { ...data, id: editingID };
      } else {
        citas.push({ ...data, id: Date.now() });
      }
      mostrarCitas();
      modal.classList.remove("is-active");
    };

    function mostrarCitas() {
      const filtro = document.getElementById("filtroEstado").value;
      const lista = document.getElementById("listaCitas");
      lista.innerHTML = "";

      citas.filter(c => filtro === "todas" || c.estado === filtro).forEach(c => {
        const tagColor = c.estado === 'Abierta' ? 'is-success' : c.estado === 'Terminada' ? 'is-info' : 'is-danger';
        
        // --- LÓGICA DEL VIDEO ---
        const esGato = c.tipoMascota.toLowerCase() === 'gato';
        const videoHTML = esGato ? 
          `<video class="video-background" autoplay muted loop playsinline>
             <source src="gato.mp4" type="video/mp4">
           </video>
           <div class="video-overlay"></div>` : '';

        lista.innerHTML += `
          <div class="column is-4">
            <div class="card mascota-card">
              ${videoHTML}
              <span class="material-symbols-rounded mascota-icono-gif">${getIcon(c.tipoMascota)}</span>
              <div class="card-content">
                <p class="title is-4 mb-1">${c.mascota}</p>
                <div class="tags has-addons mb-3">
                  <span class="tag is-dark is-uppercase">${c.tipoMascota}</span>
                  <span class="tag ${tagColor}">${c.estado}</span>
                </div>
                <div class="content is-small">
                  <p><strong>Dueño:</strong> ${c.propietario}<br>
                  <strong>Fecha:</strong> ${c.fecha} | ${c.hora}</p>
                  <p class="has-text-grey-dark"><em>${c.sintomas}</em></p>
                </div>
              </div>
              <footer class="card-footer">
                <a class="card-footer-item has-text-link" onclick="prepararEdicion(${c.id})">Editar</a>
                <a class="card-footer-item has-text-danger" onclick="borrar(${c.id})">Borrar</a>
              </footer>
            </div>
          </div>
        `;
      });
    }

    function getIcon(tipo) {
      const icons = { perro:'dog_zen', gato:'cat', ave:'flutter_dash', reptil:'pest_control_rodent', conejo:'cruelty_free', hamster:'pets', caballo:'agriculture', huron:'pets' };
      return icons[tipo] || 'pets';
    }

    window.prepararEdicion = (id) => {
      const cita = citas.find(c => c.id === id);
      editingID = id;
      document.getElementById("modalHeader").className = "modal-card-head is-edit";
      campos.forEach(campo => document.getElementById(campo).value = cita[campo]);
      modal.classList.add("is-active");
    };

    window.borrar = (id) => { if(confirm("¿Eliminar?")) { citas = citas.filter(c => c.id !== id); mostrarCitas(); } };
    document.getElementById("cerrarModal").onclick = () => modal.classList.remove("is-active");
    document.getElementById("filtroEstado").onchange = mostrarCitas;
  </script>
</body>
</html>